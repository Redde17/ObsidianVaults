Una volta creato un file, per essere usato per operazioni di i/o deve essere _aperto_. La chiamata di sistema open() passa un nome di file al file system logico. Per controllare se il file sia già in uso da parte di qualche processo, la chiamata open() dapprima esamina la tabella di sistema dei file aperti. In caso affermativo, aggiunge un elemento alla tabella dei file aperti del processo che punta alla tabella dei file aperti in tutto il sistema. Questo algoritmo può eliminare significativi overhead. Se il file non è già aperto, se ne ricerca il nome all’interno della directory. Alcune porzioni della struttura delle directory sono di solito tenute in memoria per accelerare le operazioni sulle directory. Una volta trovato il file, si copia l’fcb nella tabella di sistema dei file aperti, tenuta in memoria. Questa tabella non solo contiene l’fcb, ma tiene anche traccia del numero di processi che in quel momento hanno il file aperto.

Successivamente, si crea un elemento nella tabella dei file aperti del processo con un puntatore alla tabella di sistema e con alcuni altri campi. 
Questi altri campi possono comprendere un puntatore alla posizione corrente nel file (per successive operazioni read() o write()) e il tipo d’accesso specificato all’apertura del file. La open() riporta un puntatore all’elemento appropriato nella tabella dei file aperti del processo, sicché tutte le operazioni sul file si svolgeranno usando questo puntatore. Il nome del file potrebbe non essere contenuto nella tabella dei file aperti, visto che, una volta che il corrispondente fcb è stato individuato nei dischi, il sistema non ne ha bisogno. Tuttavia, potrebbe venir memorizzato in una cache per risparmiare tempo sulle aperture successive dello stesso file. 
Il nome dato all’elemento della tabella è detto descrittore di file (_file descriptor_) in unix, e handle del file in Windows.

Quando un processo chiude il file, si cancella il relativo elemento nella tabella dei file aperti del processo e si decrementa il contatore associato al file nella tabella di sistema. Se tutti i processi che avevano aperto il file lo hanno chiuso, si riscrivono i metadati aggiornati nella struttura della directory nei dischi e si cancella il relativo elemento nella tabella di sistema dei file aperti.

Alcuni sistemi complicano ulteriormente lo schema descritto, usando il file system come interfaccia per altri aspetti del sistema, come la comunicazione in rete. Per esempio, nell’ufs, la tabella generale dei file aperti contiene gli _inode_ e altre informazioni su file e directory, ma contiene anche informazioni simili per le connessioni di rete e i dispositivi. In questo modo si può usare un unico meccanismo per molteplici fini.

Le questioni concernenti l’uso delle cache per queste strutture non vanno però trascurate. La maggior parte dei sistemi mantiene in memoria tutta l’informazione su un file aperto, eccetto i suoi effettivi blocchi di dati. Il sistema unix bsd è noto per il suo uso di cache ovunque sia possibile risparmiare su operazioni di i/o nei dischi. La sua frequenza media di successi nella cache, pari all’85 per cento, dimostra l’utilità di queste tecniche.

![[Pasted image 20221220135836.png]]
 Strutture del file system che si mantengono nella memoria; (a) apertura di file; (b) lettura di file.