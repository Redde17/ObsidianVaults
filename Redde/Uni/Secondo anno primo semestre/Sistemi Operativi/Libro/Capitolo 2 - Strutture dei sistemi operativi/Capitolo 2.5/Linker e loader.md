Generalmente un programma risiede su disco in forma di file binario eseguibile (per esempio, i file a.out o prog.exe). Per essere eseguito su una cpu, il programma deve essere caricato in memoria e inserito nel contesto di un processo.

![[Pasted image 20221021162645.png]]

I file sorgenti vengono compilati in file oggetto progettati per essere caricati in una qualsiasi posizione della memoria fisica, noti come file oggetto rilocabili. In seguito, il linker combina i file oggetto rilocabili in un singolo file binario eseguibile. Durante la fase di collegamento (linking) possono essere inclusi altri file oggetto o alcune librerie, come la libreria standard del linguaggio C o la libreria matematica standard (ciò avviene specificando il flag -lm).

Per caricare il file eseguibile in memoria, dove diventa idoneo per l’esecuzione sul core di una cpu, viene utilizzato un loader. Un’attività associata al collegamento e al caricamento (loading) è la rilocazione (_relocation_), che assegna gli indirizzi definitivi alle componenti del programma e riaggiusta il codice e i dati nel programma secondo questi indirizzi in modo che, per esempio, il codice possa richiamare le funzioni della libreria e accedere alle sue variabili durante l’esecuzione. Nella Figura 2.11 possiamo osservare che per eseguire il loader è sufficiente scrivere il nome del file eseguibile sulla riga di comando. Quando si immette il nome di un programma sulla riga di comando dei sistemi unix (per esempio, digitando ./main) la shell crea innanzitutto un nuovo processo per eseguire il programma, utilizzando la chiamata di sistema fork(), e richiama poi il loader con la chiamata di sistema exec(), passando alla exec() il nome del file eseguibile. Il loader carica quindi in memoria il programma specificato, utilizzando lo spazio d’indirizzamento del processo appena creato. Quando si utilizza un’interfaccia grafica, facendo doppio clic sull’icona associata al file eseguibile si richiama il loader, con un meccanismo simile.

Il processo descritto finora presuppone che tutte le librerie siano collegate nel file eseguibile e caricate in memoria. In realtà, la maggior parte dei sistemi consente a un programma di collegare dinamicamente le librerie quando viene caricato. Windows, per esempio, supporta librerie collegate dinamicamente (dll). Il vantaggio di questo approccio è che si evita di collegare e caricare librerie che potrebbero non essere utilizzate. In questo caso una libreria è collegata in modo condizionale e viene caricata in memoria solo se è richiesta durante l’esecuzione del programma. Per esempio, nella Figura 2.11, la libreria matematica non è collegata al file eseguibile main; il linker inserisce piuttosto le informazioni di rilocalizzazione che permettono alla libreria di essere collegata dinamicamente e caricata in memoria quando il programma è già caricato. Nel Capitolo 9 vedremo che più processi possono condividere librerie collegate dinamicamente, con un risparmio significativo nell’uso della memoria.

I file oggetto e i file eseguibili hanno in genere formati standard e includono il codice macchina compilato e una tabella dei simboli contenente metadati relativi a funzioni e variabili a cui si fa riferimento nel programma. Nei sistemi unix e Linux questo formato standard è noto come elf (Executable and Linkable Format). Vi sono formati elf distinti per file rilocabili ed eseguibili. Un’informazione presente nel file elf per i file eseguibili è il punto di ingresso (_entry point_) del programma, che contiene l’indirizzo della prima istruzione da eseguire. I sistemi Windows utilizzano il formato pe (Portable Executable), mentre macos usa il formato Mach-O.